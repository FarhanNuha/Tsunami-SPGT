<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seismic Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #map {
            height: 100vh;
            width: 100%;
        }
        
        .earthquake-marker {
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .magnitude-label {
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 11px;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <script>
        // Inisialisasi peta (center di Indonesia)
        var map = L.map('map', {
            zoomControl: true,
            attributionControl: true
        }).setView([-2.5, 118.0], 5);
        
        // Tile layer - OpenStreetMap
        var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors',
            maxZoom: 19
        });
        
        // Tile layer - Topografi
        var topoLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenTopoMap contributors',
            maxZoom: 17
        });
        
        // Tile layer - Satellite (ESRI)
        var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '© Esri',
            maxZoom: 19
        });
        
        // Default layer
        osmLayer.addTo(map);
        
        // Layer control
        var baseMaps = {
            "OpenStreetMap": osmLayer,
            "Topografi": topoLayer,
            "Satellite": satelliteLayer
        };
        
        L.control.layers(baseMaps).addTo(map);
        
        // Array untuk menyimpan marker
        var earthquakeMarkers = [];
        
        // Scale control
        L.control.scale({
            imperial: false,
            metric: true
        }).addTo(map);
        
        // Fungsi untuk mendapatkan warna berdasarkan magnitudo
        function getMagnitudeColor(magnitude) {
            if (magnitude >= 7.0) return '#8B0000'; // Dark red
            if (magnitude >= 6.0) return '#FF0000'; // Red
            if (magnitude >= 5.0) return '#FF8C00'; // Dark orange
            if (magnitude >= 4.0) return '#FFA500'; // Orange
            if (magnitude >= 3.0) return '#FFD700'; // Gold
            return '#90EE90'; // Light green
        }
        
        // Fungsi untuk mendapatkan ukuran marker berdasarkan magnitudo
        function getMagnitudeSize(magnitude) {
            return Math.pow(2, magnitude) * 0.5;
        }
        
        // Fungsi untuk menambahkan marker gempa
        function addEarthquakeMarker(lat, lon, magnitude, time) {
            var color = getMagnitudeColor(magnitude);
            var size = getMagnitudeSize(magnitude);
            
            var circle = L.circleMarker([lat, lon], {
                radius: size,
                fillColor: color,
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.7
            });
            
            var popupContent = `
                <div style="font-family: monospace;">
                    <h4 style="margin: 0 0 8px 0; color: ${color};">
                        M ${magnitude.toFixed(1)}
                    </h4>
                    <p style="margin: 4px 0;"><b>Lat:</b> ${lat.toFixed(4)}°</p>
                    <p style="margin: 4px 0;"><b>Lon:</b> ${lon.toFixed(4)}°</p>
                    <p style="margin: 4px 0;"><b>Time:</b> ${time}</p>
                </div>
            `;
            
            circle.bindPopup(popupContent);
            circle.addTo(map);
            
            earthquakeMarkers.push(circle);
            
            // Tooltip dengan magnitudo
            circle.bindTooltip(`M${magnitude.toFixed(1)}`, {
                permanent: false,
                direction: 'top',
                className: 'magnitude-label'
            });
        }
        
        // Fungsi untuk menghapus semua marker
        function clearMarkers() {
            earthquakeMarkers.forEach(function(marker) {
                map.removeLayer(marker);
            });
            earthquakeMarkers = [];
        }
        
        // Contoh marker untuk testing
        // addEarthquakeMarker(-6.2088, 106.8456, 5.5, '2024-12-16 10:30:00');
        // addEarthquakeMarker(-7.7956, 110.3695, 6.2, '2024-12-16 11:45:00');
        // addEarthquakeMarker(-0.7893, 113.9213, 7.1, '2024-12-16 12:00:00');
    </script>
</body>
</html>
